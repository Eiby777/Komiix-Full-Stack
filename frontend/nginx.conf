# Configuración de Nginx para una Single-Page Application (SPA)
# con un endpoint de health check.

server {
    # Escucha en el puerto 80, que es el puerto estándar dentro del contenedor.
    listen 80;
    server_name localhost;

    # Define el directorio raíz donde se encuentran los archivos estáticos de tu aplicación.
    root /usr/share/nginx/html;

    # El archivo por defecto a servir es index.html.
    index index.html;

    # --- Endpoint para el Health Check ---
    # Esta ubicación responde a la verificación de estado de Docker.
    location /health {
        # Desactiva los logs de acceso para no llenar los registros con pings de salud.
        access_log off;
        
        # Devuelve una respuesta 200 OK, lo que significa que el servidor está sano.
        return 200 "OK";
        add_header Content-Type text/plain;
    }

    # --- Configuración para la SPA ---
    # Esta ubicación maneja todas las demás peticiones.
    location / {
        # Esta directiva es CRUCIAL para las SPAs.
        # 1. Intenta encontrar un archivo con el nombre exacto (ej. /assets/app.js).
        # 2. Si no lo encuentra, intenta buscar un directorio.
        # 3. Si ninguno de los anteriores funciona, sirve /index.html.
        # Esto permite que el enrutador del lado del cliente (como React Router) maneje las rutas.
        try_files $uri $uri/ /index.html;
    }

    # Opcional: Manejo de errores de Nginx.
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}